<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Route</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        h1 { color: #2c3e50; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; }
        button { background: #3498db; color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; }
    </style>
    <script>
        // Check authentication before page loads
        (async function() {
            try {
                const res = await fetch('/api/agent/me');
                if (res.status === 401) {
                    // Not logged in, redirect to login
                    window.location.href = '/admin/login.html';
                    return;
                }
                const agent = await res.json();
                // Store agent info for later use
                window.currentAgent = agent;
            } catch (err) {
                window.location.href = '/admin/login.html';
            }
        })();
    </script>
</head>
<body>
        <!-- ADD THIS TO EVERY ADMIN PAGE -->
        <div style="background: #2c3e50; padding: 15px;">
            <div style="max-width: 1200px; margin: 0 auto;">
                <a href="/admin/transport-dashboard.html" style="color: white; text-decoration: none; padding: 10px 20px; background: rgba(255,255,255,0.2); border-radius: 5px;">‚Üê Back to Dashboard</a>
            </div>
        </div>
        <div class="container">
        <h1>üõ£Ô∏è Add New Route</h1>
        <form id="routeForm">
            <div class="form-group">
                <label>Origin:</label>
                <input type="text" id="origin" required placeholder="e.g., Mzuzu">
            </div>
            <div class="form-group">
                <label>Destination:</label>
                <input type="text" id="destination" required placeholder="e.g., Bunda">
            </div>
            <div class="form-group">
                <label>Price (MWK):</label>
                <input type="number" id="price" required placeholder="e.g., 15000">
            </div>
            <button type="submit">Create Route</button>
        </form>
    </div>

    <script>
        document.getElementById('routeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                origin: document.getElementById('origin').value,
                destination: document.getElementById('destination').value,
                price: parseFloat(document.getElementById('price').value)
            };
            
            const res = await fetch('/api/admin/add-route', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            
            const result = await res.json();
            if (result.success) {
                alert('‚úÖ Route created! Route ID: ' + result.routeId);
                e.target.reset();
            } else {
                alert('‚ùå Error: ' + result.error);
            }
        });
// Add logout button functionality
        function addLogoutButton() {
            const header = document.querySelector('.header');
            if (header && !document.getElementById('logoutBtn')) {
                const logoutDiv = document.createElement('div');
                logoutDiv.style.float = 'right';
                logoutDiv.style.marginTop = '-50px';
                logoutDiv.innerHTML = `
                    <span style="color: white; margin-right: 15px;">üë§ ${window.currentAgent?.name || 'Agent'}</span>
                    <button id="logoutBtn" onclick="logout()" style="background: #e74c3c; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">Logout</button>
                `;
                header.appendChild(logoutDiv);
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                fetch('/api/agent/logout', { method: 'POST' })
                    .then(() => {
                        window.location.href = '/admin/login.html';
                    });
            }
        }

// Add logout button after page loads
        document.addEventListener('DOMContentLoaded', addLogoutButton);
    </script>
</body>
</html>